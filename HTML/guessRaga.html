<html class="center">
    <head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
            What's The Raga?
        </title>
        <link type="text/css" rel="stylesheet" href="style.css"/>
        
    </head>
    <body>
	
		<!-- <nav><ul>
			<li class="selected"><a href="index.html">Home</a></li>
<li><a href="feedback.html">Feedback</a></li>
		</ul></nav> -->
		<div class="body pretext">
			<h1>Welcome!</h1>
			<p>Are you new to Hindustani Classical music?<br>Are you always forming tunes in your head, but can never figure out what raga they are in?<br>Well, you've come to the right place!<br><br><br></p></div>
		<div class="body anim">
			
			<h1>
				What's the Raga?
			</h1>
		<div class="body">
			<p class="para"> 
				How to use: <br>
	            1. Type a phrase. For example: nSgMPnDPgMgRS. The phrase must be at least 7 notes long (not including pauses) for good accuracy.<br>
				2. Click "<strong>What's the Raga</strong>" to see which raga your phrase is in!        
			</p>
			
		</div>
			<div class="body">
				<input type="text" id="phrase" name="phrase" placeholder="Phrase" size=46/>
				<input type="submit" id="guess" value="What's the Raga?" class="gu" onclick="process()"> 
				<p id="out"></p>
				<p>Feedback? Questions? Comments? Send them at   <a>findprajju@gmail.com</a></p> 
			</div>
			<script>
				function process(){
					phrase = document.getElementById("phrase").value;
					if(phrase.length == 0){
						document.getElementById('out').innerHTML = "Phrase is empty.";
						abort();
					}
					for( var i = 0; i < phrase.length; i++){
						if(! "SrRgGM- mPdDnN".split('').includes(phrase[i])){
							document.getElementById('out').innerHTML = 'Invalid phrase. Contains non-note symbols.';
							abort();
						}
					}
					
					proceed = confirm('Are you sure you want to submit the phrase ' + phrase + '?');
					if(proceed == true) {
						
						var RAGA_INDEX = `
Bhimpalasi: nSgMPnS SnDPMgRS
Des: NSRMPNS SnDPMGRGNS
Sarang: SRMPNS SnPMRS
Jog: SGMPnS SnPMGMgS
Hindol: SGmDNS SNDMGmGS
Bageshri: SgMDnS SNDMPDgMgRS
Yaman: NRGmDNS SNDPmGRS PRGm-GRS
Pooriya Kalyan: NrGmDNS SNDPmGrS GmrG PD
Malkauns: SgMdnS SndMgS
Chandrakauns: SgMdNS SNdMgS
Bhoopali: SRGPDS SDPGRS PRGRS DRSRGRS
Durga: SRMPDS SDPMRS
Maru Bihag: SGmPNS SNDPmGmGRS
Ahir-Bhairav: SrGMPDnS SnDPMGrS
Deshkar: SRGPDS SDPDGPGRS
Jhinjoti: SRMPDS SnDPMGRGS
Jaunpuri: SRMPdnS SndPMgRS
Bihag: NSGMPNS SNDPmPGMGRS
Hamsadhwani: SRGPNS SNPGRS
Todi: SrgmPdNS SNDPmgrS
Kedar: SMGPmPDNS SNDPmPDPMRS
Bhairav: SrGMPdNS SNdPMGrS
Marwa: NrGmDNS SNDmGrS
Asavari: SRgMPdnS SndPMgRS
Darbari Kanada: SRgMPdnS SdnPMPgMRS
Kafi: SRgMPDnS SnDPMgRS
Dhani: PnSgMPnS SnPMgS
Bhairavi: SrgMPdnS SndPMgrS
Saraswati: SRmPDS SnDPmRS`.split('\n')
						var guesses = [];
						var high = 0;
						var SAPTAKS = {};
						var length = RAGA_INDEX.length;
						for(var i = 0; i < length; i++){
							SAPTAKS[RAGA_INDEX[i]] = 0;
						}
						phrase = document.getElementById("phrase").value.split('');
						while('-' in phrase){
							delete phrase[phrase.indexOf('-')];
						}
						if(phrase.length < 7){
							document.getElementById('out').innerHTML = 'Phrase is too short.';
							abort();
						}
						
						for(var x = 2; x <= phrase.length; x++){
							for(var i = 0; i <= phrase.length - x; i++){
								console.log(phrase.slice(i, i + x).join(''));
								for(var saptak = 0; saptak < Object.keys(SAPTAKS).length; saptak++){
									
									if(Object.keys(SAPTAKS)[saptak].includes(phrase.slice(i, i + x).join(''))){
				
										SAPTAKS[Object.keys(SAPTAKS)[saptak]] += 1;
									}
								}
							}
						}
						
						for(var f = 0; f < Object.values(SAPTAKS).length; f++){
							freq = Object.values(SAPTAKS)[f]
							if (freq > high){
								high = freq;
							}
						}
						
						var keys = Object.keys(SAPTAKS);
						for(var i = 0; i < keys.length; i++){
							if(SAPTAKS[Object.keys(SAPTAKS)[i]] >= high){
								guesses.push(Object.keys(SAPTAKS)[i].slice(0, Object.keys(SAPTAKS)[i].indexOf(':')))
							}
						}
						
						guesses = guesses.join(' or ');
						if(high > 8){
							document.getElementById("out").innerHTML =  "Your phrase is most likely a " + guesses + " phrase.";
							var totalPhrases = tri(phrase.length - 1); 
							console.log('Accuracy percentage: ' + high / totalPhrases * 100);
							console.log((high));
							console.log(totalPhrases);
							console.log(SAPTAKS)
							// DEBUG
							localStorage.setItem(phrase.join(''), [guesses, high, totalPhrases]);                                  
						}
						else{
							document.getElementById("out").innerHTML =  "I'm not sure which raga your phrase is in. Perhaps you entered it incorrectly?"; 
							
						}
					}	
				}
				function tri(n){
					var total = 0;
					for(var i = n; i > 0; i--){
						total += i;
					}
					return total;
				}
			</script>
		</div>
    </body>
</html>